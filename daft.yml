hooks:
  post-clone:
    jobs:
      - name: install-brew
        description: Install Homebrew package manager
        run:
          macos:
            /bin/bash -c "$(curl -fsSL
            https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
        skip:
          - run: "command -v brew"
            desc: Brew is already installed
      - name: install-mise
        description: Install mise
        run:
          macos: brew install mise
          linux: curl https://mise.run | sh
        needs: [install-brew]
        skip:
          - run: "command -v mise"
            desc: mise is already installed
      - name: mise-install
        description: Install tools from mise.toml (Rust, lefthook, bun, etc.)
        run: mise install
        needs: [install-mise]
      - name: install-lefthook-in-repo
        description: Set up lefthook git hooks in the repository
        run: lefthook install
        needs: [mise-install]
        skip:
          - run: "lefthook check-install"
            desc: Lefthook hooks are already installed

  worktree-post-create:
    jobs:
      - name: mise trust
        run: mise trust
      - name: mise install
        run: mise install
        needs: [mise trust]
      - name: bun install
        run: bun install
        needs: [mise install]

  worktree-pre-remove:
    jobs:
      - name: sandbox-clean
        description: Remove the sandbox for this worktree
        run: mise run sandbox:clean
