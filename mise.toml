# mise configuration for daft
# Run `mise tasks` to see available tasks

[tools]
rust = "stable"
lefthook = "latest"
bun = "latest"

[env]
INTEGRATION_TESTS_DIR = "tests/integration"
INTEGRATION_TEMP_DIR = "/tmp/git-worktree-integration-tests"

# Auto-install JS dependencies (Prettier) when package.json changes
[hooks]
enter = """
mkdir -p .mise
hashfile=".mise/deps_hash"
current_hash=$(cat package.json bun.lock 2>/dev/null | md5 -q 2>/dev/null || cat package.json bun.lock 2>/dev/null | md5sum | cut -d' ' -f1)
if [ ! -d "node_modules" ] || [ ! -f "$hashfile" ] || [ "$(cat "$hashfile" 2>/dev/null)" != "$current_hash" ]; then
  echo "[mise] Installing JS dependencies..."
  bun install --frozen-lockfile 2>/dev/null || bun install
  current_hash=$(cat package.json bun.lock 2>/dev/null | md5 -q 2>/dev/null || cat package.json bun.lock 2>/dev/null | md5sum | cut -d' ' -f1)
  echo "$current_hash" > "$hashfile"
fi
"""
